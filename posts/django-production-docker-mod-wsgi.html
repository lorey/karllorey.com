<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8" data-next-head=""/><meta name="viewport" content="width=device-width" data-next-head=""/><link data-next-font="" rel="preconnect" href="/" crossorigin="anonymous"/><link rel="preload" href="/_next/static/chunks/0e6c9983ded0d3b6.css" as="style"/><link rel="stylesheet" href="/_next/static/chunks/0e6c9983ded0d3b6.css" data-n-g=""/><noscript data-n-css=""></noscript><script src="/_next/static/chunks/8ed884b6d18595e8.js" defer=""></script><script src="/_next/static/chunks/acf108a5e616596f.js" defer=""></script><script src="/_next/static/chunks/20fc67605305a048.js" defer=""></script><script src="/_next/static/chunks/54696b9c9edce1fb.js" defer=""></script><script src="/_next/static/chunks/turbopack-0d1edc95cfdef760.js" defer=""></script><script src="/_next/static/chunks/d8a004d45b783aeb.js" defer=""></script><script src="/_next/static/chunks/4d75781b65c1735c.js" defer=""></script><script src="/_next/static/chunks/turbopack-ea2bb5e74303d7c4.js" defer=""></script><script src="/_next/static/nca7kaRSX5cWo37rgVdoA/_ssgManifest.js" defer=""></script><script src="/_next/static/nca7kaRSX5cWo37rgVdoA/_buildManifest.js" defer=""></script></head><body class="antialiased"><div id="__next"><div class="max-w-xl mx-auto p-5"><header class="text-center py-16"><div class="title py-4"><a href="/">Karl Lorey</a></div><nav class="my-5"><ul class="md:flex justify-center gap-4"><li><a href="/human">Human</a></li><li><a href="/founder">Founder</a></li><li><a href="/portfolio">Maker</a></li><li><a href="/techie">Techie</a></li><li><a href="/vc">Investor</a></li><li><a href="/speaker">Speaker</a></li><li><a href="/blog">Lorey Ipsum</a></li></ul></nav></header><hr class="mb-16"/><h1>Django in Production with mod_wsgi and Docker</h1><div class="text-gray-400 text-sm mb-8">1/17/2020</div><div class="markdown"><p>This article will show you how to run Django in production with docker and apache2/mod_wsgi.
While there are several guides on how to do it,
I found no simple enough tutorial on how to do it
since all of the existing solutions require a lot of configuration or a custom docker image.
The solution I found is way quicker and requires close to no configuration.</p>
<p>Guides I found:</p>
<ul>
<li><a href="https://docs.djangoproject.com/en/3.0/howto/deployment/wsgi/modwsgi/">Django with Apache and mod_wsgi</a> assumes you have installed everything already and requires configuration possibly unnecessary for a dockerized version</li>
<li><a href="https://modwsgi.readthedocs.io/en/develop/">mod_wsgi</a> explains how to install mod_wsgi, but not how to use Django with it</li>
</ul>
<p>So, let&#x27;s do this.
If you just want to see the final Dockerfile, scroll to the end of the article :)</p>
<h2>Prerequisites</h2>
<p>I assume you have some Dockerfile with Django application setup
and run Django via the command that spins up the development server:</p>
<pre><code class="language-dockerfile">FROM python:3.6

WORKDIR /code/

# copy and install requirements first to leverage caching
COPY requirements.txt /code/
RUN pip install -r requirements.txt

# copy the actual code
COPY . /code/

CMD ./manage.py runserver 0.0.0.0:8000
</code></pre>
<h2>Step 1: Install Apache</h2>
<p>We basically need a working Apache setup to run python code via mod_wsgi.
So in our Dockerfile, we need to install apache2 and apache2-dev.</p>
<pre><code class="language-dockerfile">RUN apt-get install apache2 apache2-dev
</code></pre>
<h2>Step 2: install mod_wsgi</h2>
<p>We want to run our project within a container.
The mod_wsgi documentation says the easiest and preferred using docker
is to use mod_wsgi-express as it does not require any configuration.
mod_wsgi-express can be used as a command after you have installed it via pip.
So we need to add:</p>
<pre><code class="language-dockerfile">RUN pip install mod_wsgi
</code></pre>
<h2>Step 3: run Django inside Apache with mod_wsgi</h2>
<p>Lastly, we simply have to run mod_wsgi-express
which will start an apache instance with our Django project.
This can be achieved via:</p>
<pre><code class="language-text">mod_wsgi-express start-server /code/project_name/wsgi.py --user www-data --group www-data
</code></pre>
<p>The wsgi.py file is auto-generated by Django&#x27;s <code>startproject</code> command and inside you app&#x27;s folder,
i.e. <code>django-project/project_name</code>.
So, to run our project within Apache after we&#x27;ve set-up everything in the Dockerfile,
we have to add a <code>CMD</code> command at the end of the Dockerfile:</p>
<pre><code class="language-dockerfile">CMD mod_wsgi-express start-server /code/connect_web/wsgi.py --user www-data --group www-data
</code></pre>
<p>The <code>--user</code> and <code>--group</code> parameters make sure Apache isn&#x27;t run as root which results in errors.
If you want to find out, just run the command without them.</p>
<h2>Final Dockerfile: Installing and running Apache and mod_wsgi within Docker</h2>
<p>Your final Dockerfile should now look like this:</p>
<pre><code class="language-dockerfile">FROM python:3.6

# update packages
RUN apt-get -qq update
RUN apt-get install --yes apache2 apache2-dev
RUN pip install mod_wsgi

RUN mkdir /code
WORKDIR /code

COPY . /code/

CMD mod_wsgi-express start-server /code/project_name/wsgi.py --user www-data --group www-data
</code></pre>
<h2>Troubleshooting</h2>
<p>If you have any problems, check the logs. Their locations are outputted when starting the container:</p>
<pre><code class="language-text">web_1     | Server URL         : http://localhost:8000/
web_1     | Server Root        : /tmp/mod_wsgi-localhost:8000:0
web_1     | Server Conf        : /tmp/mod_wsgi-localhost:8000:0/httpd.conf
web_1     | Error Log File     : /tmp/mod_wsgi-localhost:8000:0/error_log (warn)
web_1     | Request Capacity   : 5 (1 process * 5 threads)
web_1     | Request Timeout    : 60 (seconds)
web_1     | Startup Timeout    : 15 (seconds)
web_1     | Queue Backlog      : 100 (connections)
web_1     | Queue Timeout      : 45 (seconds)
web_1     | Server Capacity    : 20 (event/worker), 20 (prefork)
web_1     | Server Backlog     : 500 (connections)
web_1     | Locale Setting     : en_US.UTF-8
</code></pre>
<p>If you want to monitor them, just <code>tail -f</code> them:</p>
<pre><code class="language-text">tail -f /tmp/mod_wsgi-localhost:8000:0/error_log
</code></pre>
<h3>Permission problems</h3>
<p>At first, I got an <code>Internal Server Error</code> when opening the page on my machine.
After checking the logs as described above, mod_wsgi seemed to have problems with file permissions on <code>.logs/debug.log</code>.
A simple <code>chown www-data /code/.logs/debug.log</code> from within the container
which makes www-data the owner of the file solved it for me.</p></div><hr class="my-16"/><footer class="text-center text-sm py-10"><p class="">I&#x27;m Karl Lorey–Techie, Founder, and Investor living in Karlsruhe, Germany.<br/>Let&#x27;s get in touch.</p><p class="flex justify-center gap-5 flex-wrap text-xl"><a href="https://angel.co/karllorey" target="_blank"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" class="inline" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M347.1 215.4c11.7-32.6 45.4-126.9 45.4-157.1 0-26.6-15.7-48.9-43.7-48.9-44.6 0-84.6 131.7-97.1 163.1C242 144 196.6 0 156.6 0c-31.1 0-45.7 22.9-45.7 51.7 0 35.3 34.2 126.8 46.6 162-6.3-2.3-13.1-4.3-20-4.3-23.4 0-48.3 29.1-48.3 52.6 0 8.9 4.9 21.4 8 29.7-36.9 10-51.1 34.6-51.1 71.7C46 435.6 114.4 512 210.6 512c118 0 191.4-88.6 191.4-202.9 0-43.1-6.9-82-54.9-93.7zM311.7 108c4-12.3 21.1-64.3 37.1-64.3 8.6 0 10.9 8.9 10.9 16 0 19.1-38.6 124.6-47.1 148l-34-6 33.1-93.7zM142.3 48.3c0-11.9 14.5-45.7 46.3 47.1l34.6 100.3c-15.6-1.3-27.7-3-35.4 1.4-10.9-28.8-45.5-119.7-45.5-148.8zM140 244c29.3 0 67.1 94.6 67.1 107.4 0 5.1-4.9 11.4-10.6 11.4-20.9 0-76.9-76.9-76.9-97.7.1-7.7 12.7-21.1 20.4-21.1zm184.3 186.3c-29.1 32-66.3 48.6-109.7 48.6-59.4 0-106.3-32.6-128.9-88.3-17.1-43.4 3.8-68.3 20.6-68.3 11.4 0 54.3 60.3 54.3 73.1 0 4.9-7.7 8.3-11.7 8.3-16.1 0-22.4-15.5-51.1-51.4-29.7 29.7 20.5 86.9 58.3 86.9 26.1 0 43.1-24.2 38-42 3.7 0 8.3.3 11.7-.6 1.1 27.1 9.1 59.4 41.7 61.7 0-.9 2-7.1 2-7.4 0-17.4-10.6-32.6-10.6-50.3 0-28.3 21.7-55.7 43.7-71.7 8-6 17.7-9.7 27.1-13.1 9.7-3.7 20-8 27.4-15.4-1.1-11.2-5.7-21.1-16.9-21.1-27.7 0-120.6 4-120.6-39.7 0-6.7.1-13.1 17.4-13.1 32.3 0 114.3 8 138.3 29.1 18.1 16.1 24.3 113.2-31 174.7zm-98.6-126c9.7 3.1 19.7 4 29.7 6-7.4 5.4-14 12-20.3 19.1-2.8-8.5-6.2-16.8-9.4-25.1z"></path></svg></a><a href="https://www.crunchbase.com/person/karl-lorey" target="_blank"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="inline" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M239.1 6.3l-208 78c-18.7 7-31.1 25-31.1 45v225.1c0 18.2 10.3 34.8 26.5 42.9l208 104c13.5 6.8 29.4 6.8 42.9 0l208-104c16.3-8.1 26.5-24.8 26.5-42.9V129.3c0-20-12.4-37.9-31.1-44.9l-208-78C262 2.2 250 2.2 239.1 6.3zM256 68.4l192 72v1.1l-192 78-192-78v-1.1l192-72zm32 356V275.5l160-65v133.9l-160 80z"></path></svg></a><a href="https://github.com/lorey" target="_blank"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 496 512" class="inline" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg></a><a href="https://gitlab.com/lorey" target="_blank"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="inline" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M105.2 24.9c-3.1-8.9-15.7-8.9-18.9 0L29.8 199.7h132c-.1 0-56.6-174.8-56.6-174.8zM.9 287.7c-2.6 8 .3 16.9 7.1 22l247.9 184-226.2-294zm160.8-88l94.3 294 94.3-294zm349.4 88l-28.8-88-226.3 294 247.9-184c6.9-5.1 9.7-14 7.2-22zM425.7 24.9c-3.1-8.9-15.7-8.9-18.9 0l-56.6 174.8h132z"></path></svg></a><a href="https://www.goodreads.com/karllorey" target="_blank"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" class="inline" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M299.9 191.2c5.1 37.3-4.7 79-35.9 100.7-22.3 15.5-52.8 14.1-70.8 5.7-37.1-17.3-49.5-58.6-46.8-97.2 4.3-60.9 40.9-87.9 75.3-87.5 46.9-.2 71.8 31.8 78.2 78.3zM448 88v336c0 30.9-25.1 56-56 56H56c-30.9 0-56-25.1-56-56V88c0-30.9 25.1-56 56-56h336c30.9 0 56 25.1 56 56zM330 313.2s-.1-34-.1-217.3h-29v40.3c-.8.3-1.2-.5-1.6-1.2-9.6-20.7-35.9-46.3-76-46-51.9.4-87.2 31.2-100.6 77.8-4.3 14.9-5.8 30.1-5.5 45.6 1.7 77.9 45.1 117.8 112.4 115.2 28.9-1.1 54.5-17 69-45.2.5-1 1.1-1.9 1.7-2.9.2.1.4.1.6.2.3 3.8.2 30.7.1 34.5-.2 14.8-2 29.5-7.2 43.5-7.8 21-22.3 34.7-44.5 39.5-17.8 3.9-35.6 3.8-53.2-1.2-21.5-6.1-36.5-19-41.1-41.8-.3-1.6-1.3-1.3-2.3-1.3h-26.8c.8 10.6 3.2 20.3 8.5 29.2 24.2 40.5 82.7 48.5 128.2 37.4 49.9-12.3 67.3-54.9 67.4-106.3z"></path></svg></a><a href="https://www.instagram.com/karllorey" target="_blank"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" class="inline" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M224.1 141c-63.6 0-114.9 51.3-114.9 114.9s51.3 114.9 114.9 114.9S339 319.5 339 255.9 287.7 141 224.1 141zm0 189.6c-41.1 0-74.7-33.5-74.7-74.7s33.5-74.7 74.7-74.7 74.7 33.5 74.7 74.7-33.6 74.7-74.7 74.7zm146.4-194.3c0 14.9-12 26.8-26.8 26.8-14.9 0-26.8-12-26.8-26.8s12-26.8 26.8-26.8 26.8 12 26.8 26.8zm76.1 27.2c-1.7-35.9-9.9-67.7-36.2-93.9-26.2-26.2-58-34.4-93.9-36.2-37-2.1-147.9-2.1-184.9 0-35.8 1.7-67.6 9.9-93.9 36.1s-34.4 58-36.2 93.9c-2.1 37-2.1 147.9 0 184.9 1.7 35.9 9.9 67.7 36.2 93.9s58 34.4 93.9 36.2c37 2.1 147.9 2.1 184.9 0 35.9-1.7 67.7-9.9 93.9-36.2 26.2-26.2 34.4-58 36.2-93.9 2.1-37 2.1-147.8 0-184.8zM398.8 388c-7.8 19.6-22.9 34.7-42.6 42.6-29.5 11.7-99.5 9-132.1 9s-102.7 2.6-132.1-9c-19.6-7.8-34.7-22.9-42.6-42.6-11.7-29.5-9-99.5-9-132.1s-2.6-102.7 9-132.1c7.8-19.6 22.9-34.7 42.6-42.6 29.5-11.7 99.5-9 132.1-9s102.7-2.6 132.1 9c19.6 7.8 34.7 22.9 42.6 42.6 11.7 29.5 9 99.5 9 132.1s2.7 102.7-9 132.1z"></path></svg></a><a href="https://www.linkedin.com/in/karllorey" target="_blank"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" class="inline" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg></a><a href="https://medium.com/@karllorey" target="_blank"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" class="inline" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M0 32v448h448V32H0zm372.2 106.1l-24 23c-2.1 1.6-3.1 4.2-2.7 6.7v169.3c-.4 2.6.6 5.2 2.7 6.7l23.5 23v5.1h-118V367l24.3-23.6c2.4-2.4 2.4-3.1 2.4-6.7V199.8l-67.6 171.6h-9.1L125 199.8v115c-.7 4.8 1 9.7 4.4 13.2l31.6 38.3v5.1H71.2v-5.1l31.6-38.3c3.4-3.5 4.9-8.4 4.1-13.2v-133c.4-3.7-1-7.3-3.8-9.8L75 138.1V133h87.3l67.4 148L289 133.1h83.2v5z"></path></svg></a><a href="https://www.meetup.com/members/196097665/" target="_blank"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="inline" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M99 414.3c1.1 5.7-2.3 11.1-8 12.3-5.4 1.1-10.9-2.3-12-8-1.1-5.4 2.3-11.1 7.7-12.3 5.4-1.2 11.1 2.3 12.3 8zm143.1 71.4c-6.3 4.6-8 13.4-3.7 20 4.6 6.6 13.4 8.3 20 3.7 6.3-4.6 8-13.4 3.4-20-4.2-6.5-13.1-8.3-19.7-3.7zm-86-462.3c6.3-1.4 10.3-7.7 8.9-14-1.1-6.6-7.4-10.6-13.7-9.1-6.3 1.4-10.3 7.7-9.1 14 1.4 6.6 7.6 10.6 13.9 9.1zM34.4 226.3c-10-6.9-23.7-4.3-30.6 6-6.9 10-4.3 24 5.7 30.9 10 7.1 23.7 4.6 30.6-5.7 6.9-10.4 4.3-24.1-5.7-31.2zm272-170.9c10.6-6.3 13.7-20 7.7-30.3-6.3-10.6-19.7-14-30-7.7s-13.7 20-7.4 30.6c6 10.3 19.4 13.7 29.7 7.4zm-191.1 58c7.7-5.4 9.4-16 4.3-23.7s-15.7-9.4-23.1-4.3c-7.7 5.4-9.4 16-4.3 23.7 5.1 7.8 15.6 9.5 23.1 4.3zm372.3 156c-7.4 1.7-12.3 9.1-10.6 16.9 1.4 7.4 8.9 12.3 16.3 10.6 7.4-1.4 12.3-8.9 10.6-16.6-1.5-7.4-8.9-12.3-16.3-10.9zm39.7-56.8c-1.1-5.7-6.6-9.1-12-8-5.7 1.1-9.1 6.9-8 12.6 1.1 5.4 6.6 9.1 12.3 8 5.4-1.5 9.1-6.9 7.7-12.6zM447 138.9c-8.6 6-10.6 17.7-4.9 26.3 5.7 8.6 17.4 10.6 26 4.9 8.3-6 10.3-17.7 4.6-26.3-5.7-8.7-17.4-10.9-25.7-4.9zm-6.3 139.4c26.3 43.1 15.1 100-26.3 129.1-17.4 12.3-37.1 17.7-56.9 17.1-12 47.1-69.4 64.6-105.1 32.6-1.1.9-2.6 1.7-3.7 2.9-39.1 27.1-92.3 17.4-119.4-22.3-9.7-14.3-14.6-30.6-15.1-46.9-65.4-10.9-90-94-41.1-139.7-28.3-46.9.6-107.4 53.4-114.9C151.6 70 234.1 38.6 290.1 82c67.4-22.3 136.3 29.4 130.9 101.1 41.1 12.6 52.8 66.9 19.7 95.2zm-70 74.3c-3.1-20.6-40.9-4.6-43.1-27.1-3.1-32 43.7-101.1 40-128-3.4-24-19.4-29.1-33.4-29.4-13.4-.3-16.9 2-21.4 4.6-2.9 1.7-6.6 4.9-11.7-.3-6.3-6-11.1-11.7-19.4-12.9-12.3-2-17.7 2-26.6 9.7-3.4 2.9-12 12.9-20 9.1-3.4-1.7-15.4-7.7-24-11.4-16.3-7.1-40 4.6-48.6 20-12.9 22.9-38 113.1-41.7 125.1-8.6 26.6 10.9 48.6 36.9 47.1 11.1-.6 18.3-4.6 25.4-17.4 4-7.4 41.7-107.7 44.6-112.6 2-3.4 8.9-8 14.6-5.1 5.7 3.1 6.9 9.4 6 15.1-1.1 9.7-28 70.9-28.9 77.7-3.4 22.9 26.9 26.6 38.6 4 3.7-7.1 45.7-92.6 49.4-98.3 4.3-6.3 7.4-8.3 11.7-8 3.1 0 8.3.9 7.1 10.9-1.4 9.4-35.1 72.3-38.9 87.7-4.6 20.6 6.6 41.4 24.9 50.6 11.4 5.7 62.5 15.7 58.5-11.1zm5.7 92.3c-10.3 7.4-12.9 22-5.7 32.6 7.1 10.6 21.4 13.1 32 6 10.6-7.4 13.1-22 6-32.6-7.4-10.6-21.7-13.5-32.3-6z"></path></svg></a><a href="https://www.producthunt.com/@karllorey" target="_blank"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="inline" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M326.3 218.8c0 20.5-16.7 37.2-37.2 37.2h-70.3v-74.4h70.3c20.5 0 37.2 16.7 37.2 37.2zM504 256c0 137-111 248-248 248S8 393 8 256 119 8 256 8s248 111 248 248zm-128.1-37.2c0-47.9-38.9-86.8-86.8-86.8H169.2v248h49.6v-74.4h70.3c47.9 0 86.8-38.9 86.8-86.8z"></path></svg></a><a href="https://www.researchgate.net/profile/Karl_Lorey" target="_blank"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" class="inline" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M0 32v448h448V32H0zm262.2 334.4c-6.6 3-33.2 6-50-14.2-9.2-10.6-25.3-33.3-42.2-63.6-8.9 0-14.7 0-21.4-.6v46.4c0 23.5 6 21.2 25.8 23.9v8.1c-6.9-.3-23.1-.8-35.6-.8-13.1 0-26.1.6-33.6.8v-8.1c15.5-2.9 22-1.3 22-23.9V225c0-22.6-6.4-21-22-23.9V193c25.8 1 53.1-.6 70.9-.6 31.7 0 55.9 14.4 55.9 45.6 0 21.1-16.7 42.2-39.2 47.5 13.6 24.2 30 45.6 42.2 58.9 7.2 7.8 17.2 14.7 27.2 14.7v7.3zm22.9-135c-23.3 0-32.2-15.7-32.2-32.2V167c0-12.2 8.8-30.4 34-30.4s30.4 17.9 30.4 17.9l-10.7 7.2s-5.5-12.5-19.7-12.5c-7.9 0-19.7 7.3-19.7 19.7v26.8c0 13.4 6.6 23.3 17.9 23.3 14.1 0 21.5-10.9 21.5-26.8h-17.9v-10.7h30.4c0 20.5 4.7 49.9-34 49.9zm-116.5 44.7c-9.4 0-13.6-.3-20-.8v-69.7c6.4-.6 15-.6 22.5-.6 23.3 0 37.2 12.2 37.2 34.5 0 21.9-15 36.6-39.7 36.6z"></path></svg></a><a href="https://twitter.com/karllorey" target="_blank"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="inline" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg></a></p><p class="mt-5">This site does not use cookies or other services to improve your experience. No data is stored. It is released as<!-- --> <a href="https://github.com/lorey/karllorey.com">Open Source on Github</a>.</p><p class="mt-5">© Copyright 2025 Karl Lorey.<!-- --> <!-- -->Last updated:<!-- --> <!-- -->Dec 28, 2025<!-- --> <!-- -->(<!-- -->696e61d<!-- -->)<br/><a href="/legal">Legal/Imprint</a>.<!-- --> <a href="/privacy">Privacy Policy</a>.</p></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"Django in Production with mod_wsgi and Docker","slug":"django-production-docker-mod-wsgi","date":"2020-01-17T09:30:13.000Z","tags":"Django, Python, Docker, Tech","category":"Tech","link":null,"description":null,"type":"text","content":"\nThis article will show you how to run Django in production with docker and apache2/mod_wsgi.\nWhile there are several guides on how to do it,\nI found no simple enough tutorial on how to do it\nsince all of the existing solutions require a lot of configuration or a custom docker image.\nThe solution I found is way quicker and requires close to no configuration.\n\nGuides I found:\n\n- [Django with Apache and mod_wsgi](https://docs.djangoproject.com/en/3.0/howto/deployment/wsgi/modwsgi/) assumes you have installed everything already and requires configuration possibly unnecessary for a dockerized version\n- [mod_wsgi](https://modwsgi.readthedocs.io/en/develop/) explains how to install mod_wsgi, but not how to use Django with it\n\nSo, let's do this.\nIf you just want to see the final Dockerfile, scroll to the end of the article :)\n\n## Prerequisites\n\nI assume you have some Dockerfile with Django application setup\nand run Django via the command that spins up the development server:\n\n```dockerfile\nFROM python:3.6\n\nWORKDIR /code/\n\n# copy and install requirements first to leverage caching\nCOPY requirements.txt /code/\nRUN pip install -r requirements.txt\n\n# copy the actual code\nCOPY . /code/\n\nCMD ./manage.py runserver 0.0.0.0:8000\n```\n\n## Step 1: Install Apache\n\nWe basically need a working Apache setup to run python code via mod_wsgi.\nSo in our Dockerfile, we need to install apache2 and apache2-dev.\n\n```dockerfile\nRUN apt-get install apache2 apache2-dev\n```\n\n## Step 2: install mod_wsgi\n\nWe want to run our project within a container.\nThe mod_wsgi documentation says the easiest and preferred using docker\nis to use mod_wsgi-express as it does not require any configuration.\nmod_wsgi-express can be used as a command after you have installed it via pip.\nSo we need to add:\n\n```dockerfile\nRUN pip install mod_wsgi\n```\n\n## Step 3: run Django inside Apache with mod_wsgi\n\nLastly, we simply have to run mod_wsgi-express\nwhich will start an apache instance with our Django project.\nThis can be achieved via:\n\n```text\nmod_wsgi-express start-server /code/project_name/wsgi.py --user www-data --group www-data\n```\n\nThe wsgi.py file is auto-generated by Django's `startproject` command and inside you app's folder,\ni.e. `django-project/project_name`.\nSo, to run our project within Apache after we've set-up everything in the Dockerfile,\nwe have to add a `CMD` command at the end of the Dockerfile:\n\n```dockerfile\nCMD mod_wsgi-express start-server /code/connect_web/wsgi.py --user www-data --group www-data\n```\n\nThe `--user` and `--group` parameters make sure Apache isn't run as root which results in errors.\nIf you want to find out, just run the command without them.\n\n## Final Dockerfile: Installing and running Apache and mod_wsgi within Docker\n\nYour final Dockerfile should now look like this:\n\n```dockerfile\nFROM python:3.6\n\n# update packages\nRUN apt-get -qq update\nRUN apt-get install --yes apache2 apache2-dev\nRUN pip install mod_wsgi\n\nRUN mkdir /code\nWORKDIR /code\n\nCOPY . /code/\n\nCMD mod_wsgi-express start-server /code/project_name/wsgi.py --user www-data --group www-data\n```\n\n## Troubleshooting\n\nIf you have any problems, check the logs. Their locations are outputted when starting the container:\n\n```text\nweb_1     | Server URL         : http://localhost:8000/\nweb_1     | Server Root        : /tmp/mod_wsgi-localhost:8000:0\nweb_1     | Server Conf        : /tmp/mod_wsgi-localhost:8000:0/httpd.conf\nweb_1     | Error Log File     : /tmp/mod_wsgi-localhost:8000:0/error_log (warn)\nweb_1     | Request Capacity   : 5 (1 process * 5 threads)\nweb_1     | Request Timeout    : 60 (seconds)\nweb_1     | Startup Timeout    : 15 (seconds)\nweb_1     | Queue Backlog      : 100 (connections)\nweb_1     | Queue Timeout      : 45 (seconds)\nweb_1     | Server Capacity    : 20 (event/worker), 20 (prefork)\nweb_1     | Server Backlog     : 500 (connections)\nweb_1     | Locale Setting     : en_US.UTF-8\n```\n\nIf you want to monitor them, just `tail -f` them:\n\n```text\ntail -f /tmp/mod_wsgi-localhost:8000:0/error_log\n```\n\n### Permission problems\n\nAt first, I got an `Internal Server Error` when opening the page on my machine.\nAfter checking the logs as described above, mod_wsgi seemed to have problems with file permissions on `.logs/debug.log`.\nA simple `chown www-data /code/.logs/debug.log` from within the container\nwhich makes www-data the owner of the file solved it for me.\n"},"mdxSource":{"compiledSource":"\"use strict\";\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst {useMDXComponents: _provideComponents} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = {\n    a: \"a\",\n    code: \"code\",\n    h2: \"h2\",\n    h3: \"h3\",\n    li: \"li\",\n    p: \"p\",\n    pre: \"pre\",\n    ul: \"ul\",\n    ..._provideComponents(),\n    ...props.components\n  };\n  return _jsxs(_Fragment, {\n    children: [_jsx(_components.p, {\n      children: \"This article will show you how to run Django in production with docker and apache2/mod_wsgi.\\nWhile there are several guides on how to do it,\\nI found no simple enough tutorial on how to do it\\nsince all of the existing solutions require a lot of configuration or a custom docker image.\\nThe solution I found is way quicker and requires close to no configuration.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Guides I found:\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.a, {\n          href: \"https://docs.djangoproject.com/en/3.0/howto/deployment/wsgi/modwsgi/\",\n          children: \"Django with Apache and mod_wsgi\"\n        }), \" assumes you have installed everything already and requires configuration possibly unnecessary for a dockerized version\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.a, {\n          href: \"https://modwsgi.readthedocs.io/en/develop/\",\n          children: \"mod_wsgi\"\n        }), \" explains how to install mod_wsgi, but not how to use Django with it\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"So, let's do this.\\nIf you just want to see the final Dockerfile, scroll to the end of the article :)\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Prerequisites\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"I assume you have some Dockerfile with Django application setup\\nand run Django via the command that spins up the development server:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-dockerfile\",\n        children: \"FROM python:3.6\\n\\nWORKDIR /code/\\n\\n# copy and install requirements first to leverage caching\\nCOPY requirements.txt /code/\\nRUN pip install -r requirements.txt\\n\\n# copy the actual code\\nCOPY . /code/\\n\\nCMD ./manage.py runserver 0.0.0.0:8000\\n\"\n      })\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Step 1: Install Apache\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"We basically need a working Apache setup to run python code via mod_wsgi.\\nSo in our Dockerfile, we need to install apache2 and apache2-dev.\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-dockerfile\",\n        children: \"RUN apt-get install apache2 apache2-dev\\n\"\n      })\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Step 2: install mod_wsgi\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"We want to run our project within a container.\\nThe mod_wsgi documentation says the easiest and preferred using docker\\nis to use mod_wsgi-express as it does not require any configuration.\\nmod_wsgi-express can be used as a command after you have installed it via pip.\\nSo we need to add:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-dockerfile\",\n        children: \"RUN pip install mod_wsgi\\n\"\n      })\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Step 3: run Django inside Apache with mod_wsgi\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Lastly, we simply have to run mod_wsgi-express\\nwhich will start an apache instance with our Django project.\\nThis can be achieved via:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-text\",\n        children: \"mod_wsgi-express start-server /code/project_name/wsgi.py --user www-data --group www-data\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"The wsgi.py file is auto-generated by Django's \", _jsx(_components.code, {\n        children: \"startproject\"\n      }), \" command and inside you app's folder,\\ni.e. \", _jsx(_components.code, {\n        children: \"django-project/project_name\"\n      }), \".\\nSo, to run our project within Apache after we've set-up everything in the Dockerfile,\\nwe have to add a \", _jsx(_components.code, {\n        children: \"CMD\"\n      }), \" command at the end of the Dockerfile:\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-dockerfile\",\n        children: \"CMD mod_wsgi-express start-server /code/connect_web/wsgi.py --user www-data --group www-data\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"The \", _jsx(_components.code, {\n        children: \"--user\"\n      }), \" and \", _jsx(_components.code, {\n        children: \"--group\"\n      }), \" parameters make sure Apache isn't run as root which results in errors.\\nIf you want to find out, just run the command without them.\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Final Dockerfile: Installing and running Apache and mod_wsgi within Docker\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Your final Dockerfile should now look like this:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-dockerfile\",\n        children: \"FROM python:3.6\\n\\n# update packages\\nRUN apt-get -qq update\\nRUN apt-get install --yes apache2 apache2-dev\\nRUN pip install mod_wsgi\\n\\nRUN mkdir /code\\nWORKDIR /code\\n\\nCOPY . /code/\\n\\nCMD mod_wsgi-express start-server /code/project_name/wsgi.py --user www-data --group www-data\\n\"\n      })\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Troubleshooting\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"If you have any problems, check the logs. Their locations are outputted when starting the container:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-text\",\n        children: \"web_1     | Server URL         : http://localhost:8000/\\nweb_1     | Server Root        : /tmp/mod_wsgi-localhost:8000:0\\nweb_1     | Server Conf        : /tmp/mod_wsgi-localhost:8000:0/httpd.conf\\nweb_1     | Error Log File     : /tmp/mod_wsgi-localhost:8000:0/error_log (warn)\\nweb_1     | Request Capacity   : 5 (1 process * 5 threads)\\nweb_1     | Request Timeout    : 60 (seconds)\\nweb_1     | Startup Timeout    : 15 (seconds)\\nweb_1     | Queue Backlog      : 100 (connections)\\nweb_1     | Queue Timeout      : 45 (seconds)\\nweb_1     | Server Capacity    : 20 (event/worker), 20 (prefork)\\nweb_1     | Server Backlog     : 500 (connections)\\nweb_1     | Locale Setting     : en_US.UTF-8\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"If you want to monitor them, just \", _jsx(_components.code, {\n        children: \"tail -f\"\n      }), \" them:\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-text\",\n        children: \"tail -f /tmp/mod_wsgi-localhost:8000:0/error_log\\n\"\n      })\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"Permission problems\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"At first, I got an \", _jsx(_components.code, {\n        children: \"Internal Server Error\"\n      }), \" when opening the page on my machine.\\nAfter checking the logs as described above, mod_wsgi seemed to have problems with file permissions on \", _jsx(_components.code, {\n        children: \".logs/debug.log\"\n      }), \".\\nA simple \", _jsx(_components.code, {\n        children: \"chown www-data /code/.logs/debug.log\"\n      }), \" from within the container\\nwhich makes www-data the owner of the file solved it for me.\"]\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = {\n    ..._provideComponents(),\n    ...props.components\n  };\n  return MDXLayout ? _jsx(MDXLayout, {\n    ...props,\n    children: _jsx(_createMdxContent, {\n      ...props\n    })\n  }) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","frontmatter":{},"scope":{}}},"__N_SSG":true},"page":"/posts/[slug]","query":{"slug":"django-production-docker-mod-wsgi"},"buildId":"nca7kaRSX5cWo37rgVdoA","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>