<!DOCTYPE html>
<html prefix="
        og: http://ogp.me/ns# article: http://ogp.me/ns/article#
    " vocab="http://ogp.me/ns" lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<title>How to set up Black with Debian, PyCharm, and IdeaVim | Karl Lorey</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="../../rss.xml">
<link rel="canonical" href="https://karllorey.com/posts/set-up-black-pycharm-ideavim/">
<!--[if lt IE 9]><script src="../../assets/js/html5shiv-printshiv.min.js"></script><![endif]--><meta name="author" content="Karl Lorey">
<link rel="prev" href="../keeping-pandas-dataframes-clean-importing-json/" title="Keeping Pandas DataFrames clean when importing JSON (with Context Managers)" type="text/html">
<link rel="next" href="../recover-aws-ec2-instance-without-private-key/" title="How to recover an AWS EC2 instance without the private key" type="text/html">
<meta property="og:site_name" content="Karl Lorey">
<meta property="og:title" content="How to set up Black with Debian, PyCharm, and IdeaVim">
<meta property="og:url" content="https://karllorey.com/posts/set-up-black-pycharm-ideavim/">
<meta property="og:description" content="I've come to like the code formatter Black for Python.
It's opinionated, deterministic and thus very minimalistic.
And since I'm using it on more and more projects, I wanted to integrate it into my wo">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2019-07-28T10:30:13+01:00">
<meta property="article:tag" content="Black">
<meta property="article:tag" content="Docker">
<meta property="article:tag" content="IdeaVim">
<meta property="article:tag" content="Pycharm">
<meta property="article:tag" content="Python">
<meta property="article:tag" content="Tech">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
<link href="https://fonts.googleapis.com/css?family=Lato:300,400,700%7CPlayfair+Display:400,700" rel="stylesheet">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
<link rel="stylesheet" href="../../assets/css/style.css">
<script>
  var dnt = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
  if (dnt != "1" && dnt != "yes") {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','__gaTracker');

    __gaTracker('create', 'UA-73074199-1', 'auto');
    __gaTracker('set', 'forceSSL', true);
    __gaTracker('set', 'anonymizeIp', true);
    __gaTracker('send','pageview');
  } else {
    console.debug("Respecting Do-Not-Track, not loading analytics. See https://www.paulfurley.com/google-analytics-dnt/");
  }
</script>
</head>
<body>
    <a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>
    <div id="container">
             <header id="header"><p id="brand" class="display-1">
        <a href="https://karllorey.com/" title="Karl Lorey" rel="home">

            <span id="blog-title">Karl Lorey</span>
        </a>
    </p>

            <nav><ul class="nav justify-content-center">
<li class="nav-link">
                <a href="../../techie/">Techie</a>
            </li>
            <li class="nav-link">
                <a href="../../founder/">Founder</a>
            </li>
            <li class="nav-link">
                <a href="../../vc/">Investor</a>
            </li>
            <li class="nav-link">
                <a href="../../speaker/">Speaker</a>
            </li>
            <li class="nav-link">
                <a href="../../human/">Human</a>
            </li>
            <li class="nav-link">
                <a href="../../blog/">Lorey Ipsum</a>
            </li>
        </ul></nav></header><main id="content" class="page"><hr style="margin-bottom: 50px">
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">How to set up Black with Debian, PyCharm, and IdeaVim</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    Karl Lorey
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2019-07-28T10:30:13+01:00" itemprop="datePublished" title="2019-07-28">2019-07-28</time></a>
            </p>
                    <p class="sourceline"><a href="index.md" class="sourcelink">Source</a></p>

        </div>
        
    </header><div class="e-content entry-content" itemprop="articleBody text">
        <div>
<p>I've come to like the code formatter <a href="https://black.readthedocs.io/en/stable/index.html">Black</a> for Python.
It's opinionated, deterministic and thus very minimalistic.
And since I'm using it on more and more projects, I wanted to integrate it into my workflow.</p>
<p>So usually, you just install Black globally via <code>pip3 install black</code>.
But since I use Debian which still ships with Python 3.5
this yielded some smaller challenges as Black only runs under Python 3.6+.
This post is a small tutorial on how you can use Black on Debian and integrate it into the command line, PyCharm, and IdeaVim.</p>
<h3>Challenge 1: Python 3.6+ on Debian</h3>
<p>Since Debian currently ships with Python 3.5, I needed to get Python 3.6 running somehow.
While installing <a href="https://www.anaconda.com/distribution/">Anaconda</a> or <a href="https://www.python.org/downloads/">Python 3.6+ manually</a>
are other solutions <a href="https://community.hortonworks.com/idea/212478/independent-python-vs-anaconda-python.html">might</a> <a href="https://unix.stackexchange.com/q/332641">work</a>,
I decided to simply use Docker, as this is what I use for my regular development anyhow.
Simplest solution was to use an existing docker image,
namely <a href="https://github.com/jbbarth/docker-black">jbbarth's docker-black</a>,
which allows you to mount the current working directory into a (newly created) container, format the desired file, and throw the container away afterwards.
Sounds more complicated than it is, you just run one single command et voila.
This method has the additional benefit that it adheres to any <a href="https://github.com/psf/black#pyprojecttoml">pyproject.toml</a> which can store configuration like line length.
There's also a more sleek image at <a href="https://github.com/cytopia/docker-black">cytopia/docker-black</a> which might take less space.</p>
<p>So to run black irrespective of your local Python installation via <code>black main.py</code>,
you run</p>
<pre class="code literal-block"><span></span><code>docker run --rm -v $(pwd):/code jbbarth/black main.py
</code></pre>


<p>This creates a new container, mounts the current working directory into <code>/code</code> and formats <code>main.py</code>.
Afterwards, the <code>--rm</code> flag will delete the container as well as the created volume.
So far, so good, but as this command is quote long, I had to build an alias to invoke it quickly as a next step.</p>
<h3>Challenge 2: Black from command line</h3>
<p>So to avoid the cumbersome docker syntax each time, you now want an alias to just run <code>black main.py</code> everywhere.
To do this, you have to map the black command to your black running inside docker.
You can do this by adding</p>
<pre class="code literal-block"><span></span><code>black() { docker run --rm -v $(pwd):/code jbbarth/black $*; }
</code></pre>


<p>to your bashrc or zshrc.
After opening a new terminal, you should now be able to invoke the black formatter inside docker by running <code>black ...</code>.</p>
<h3>Challenge 3: Black in PyCharm</h3>
<p>To now integrate this setup into PyCharm,
you have to slightly adapt the <a href="https://black.readthedocs.io/en/stable/editor_integration.html#pycharm-intellij-idea">offical installation instructions</a>.
Go to <code>File -&gt; Settings -&gt; Tools -&gt; External Tools</code>.
Click the + icon to add a new external tool with the following values:</p>
<ul>
<li>Name: <code>Black</code>
</li>
<li>Description: <code>Black code formatter</code>
</li>
<li>Program: <code>/usr/bin/docker</code>
</li>
<li>Arguments: <code>run --rm -v $FilePath$:/$FilePath$ jbbarth/black "$FilePath$"</code>
</li>
<li>Working directory: <code>$ProjectFileDir$</code>
</li>
</ul>
<p>Test it by running it with an opened python file via <code>Tools -&gt; External Tools -&gt; Black</code>.
After you made sure it works, re-open it again and untick <code>open console</code> to avoid a new console at every run.
You can basically mirror this guide to install a file watcher
that formats on every save (see <a href="https://black.readthedocs.io/en/stable/editor_integration.html#pycharm-intellij-idea">the docs</a>).</p>
<p>Note: As you can see, this only mounts the current file and thus does not adhere to any config files.
The same applies for the next step as it builds upon this one.</p>
<h3>Challenge 4: Black in IdeaVim</h3>
<p>Now for the bonus part: to trigger this setup quickly from within IdeaVim and format the current file with a single command,
equivalent to the <a href="https://black.readthedocs.io/en/stable/editor_integration.html#vim">regular vim plugin</a>,
we have to map the <code>:Black</code> command to our external command in PyCharm.
To do this, we edit our <code>.ideavimrc</code> file where all IdeaVim configuration is stored,
and add the following line:</p>
<pre class="code literal-block"><span></span><code>command Black action Tool_External Tools_Black
</code></pre>


<p>Now typing <code>:Black</code> will re-format the current file.</p>
<h3>Summary</h3>
<p>This tutorial showed you one way to include Black into you daily development (esp. on Debian).
If you have any questions or feedback, hit me up on Twitter <a href="https://twitter.com/karllorey">@karllorey</a>
or any of the other platforms listed below.</p>
<h3>Notes</h3>
<h4>Deleting all docker containers of a specific image</h4>
<p>If you want to remove all containers derived from a specific image, e.g. if you forgot to add the --rm flag:</p>
<pre class="code literal-block"><span></span><code>docker rm $(docker ps -a --filter ancestor=jbbarth/black -q)
</code></pre>
</div>
    </div>

    <hr class="mt-5 mb-5">
<aside class="postpromonav"><nav><p class="mb-0">Tags:</p>
                    <ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/black/" rel="tag">Black</a></li>
            <li><a class="tag p-category" href="../../categories/docker/" rel="tag">Docker</a></li>
            <li><a class="tag p-category" href="../../categories/ideavim/" rel="tag">IdeaVim</a></li>
            <li><a class="tag p-category" href="../../categories/pycharm/" rel="tag">Pycharm</a></li>
            <li><a class="tag p-category" href="../../categories/python/" rel="tag">Python</a></li>
            <li><a class="tag p-category" href="../../categories/tech/" rel="tag">Tech</a></li>
        </ul>
<p class="mb-0">Posts:</p>
                    <ul class="pager hidden-print">
<li class="previous">
                <a href="../keeping-pandas-dataframes-clean-importing-json/" rel="prev" title="Keeping Pandas DataFrames clean when importing JSON (with Context Managers)">Previous post</a>
            </li>
            <li class="next">
                <a href="../recover-aws-ec2-instance-without-private-key/" rel="next" title="How to recover an AWS EC2 instance without the private key">Next post</a>
            </li>
        </ul></nav></aside></article><hr style="margin-top: 50px"></main><nav><ul class="nav justify-content-center">
<li class="nav-link">
                 <a href="../../archive.html">Archive</a>
             </li>
             <li class="nav-link">
                 <a href="../../categories/">Categories</a>
             </li>
             <li class="nav-link">
                 <a href="../../rss.xml">RSS feed</a>
             </li>
         </ul></nav><footer><p>I'm Karl Lorey–Techie, Founder, and Investor living in Karlsruhe, Germany. Let's get in touch.</p>
    <p class="lead socials">
            <a href="https://angel.co/karllorey" target="_blank"><i class="fab fa-angellist"></i></a>
            <a href="https://www.crunchbase.com/person/karl-lorey" target="_blank"><i class="fas fa-cube"></i></a>
            <a href="https://github.com/lorey" target="_blank"><i class="fab fa-github"></i></a>
            <a href="https://gitlab.com/lorey" target="_blank"><i class="fab fa-gitlab"></i></a>
            <a href="https://www.goodreads.com/karllorey" target="_blank"><i class="fab fa-goodreads"></i></a>
            <a href="https://www.instagram.com/karllorey" target="_blank"><i class="fab fa-instagram"></i></a>
            <a href="https://www.linkedin.com/in/karllorey" target="_blank"><i class="fab fa-linkedin"></i></a>
            <a href="https://medium.com/@karllorey" target="_blank"><i class="fab fa-medium"></i></a>
            <a href="https://www.meetup.com/members/196097665/" target="_blank"><i class="fab fa-meetup"></i></a>
            <a href="https://www.producthunt.com/@karllorey" target="_blank"><i class="fab fa-product-hunt"></i></a>
            <a href="https://www.researchgate.net/profile/Karl_Lorey" target="_blank"><i class="fab fa-researchgate"></i></a>
            <a href="https://twitter.com/karllorey" target="_blank"><i class="fab fa-twitter"></i></a>
    </p>
    <p>
        This site uses cookies and external services to improve your experience.<br>
        At least if you don't refuse by sending <a href="http://randomwalker.info/donottrack-archive/" target="_blank">Do Not Track</a>.
    </p>
    <p>© Copyright 2020 by Karl Lorey. <a href="http://karllorey.de/impressum" target="_blank">Legal/Imprint</a>.</p>
</footer>
</div>
                <script src="../../assets/js/all-nocdn.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script>
</body>
</html>
