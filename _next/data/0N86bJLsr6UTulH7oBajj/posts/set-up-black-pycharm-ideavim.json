{"pageProps":{"post":{"title":"How to set up Black with Debian, PyCharm, and IdeaVim","slug":"set-up-black-pycharm-ideavim","date":"2019-07-28T09:30:13.000Z","tags":"Python, Black, Docker, Pycharm, IdeaVim, Tech","category":"Tech","link":null,"description":"Run the Python formatter in Docker and integrate it with your IDE.","type":"text","content":"\nI've come to like the code formatter [Black](https://black.readthedocs.io/en/stable/index.html) for Python.\nIt's opinionated, deterministic and thus very minimalistic.\nAnd since I'm using it on more and more projects, I wanted to integrate it into my workflow.\n\nSo usually, you just install Black globally via `pip3 install black`.\nBut since I use Debian which still ships with Python 3.5\nthis yielded some smaller challenges as Black only runs under Python 3.6+.\nThis post is a small tutorial on how you can use Black on Debian and integrate it into the command line, PyCharm, and IdeaVim.\n\n## Challenge 1: Python 3.6+ on Debian\n\nSince Debian currently ships with Python 3.5, I needed to get Python 3.6 running somehow.\nWhile installing [Anaconda](https://www.anaconda.com/distribution/) or [Python 3.6+ manually](https://www.python.org/downloads/)\nare other solutions [might](https://community.hortonworks.com/idea/212478/independent-python-vs-anaconda-python.html) [work](https://unix.stackexchange.com/q/332641),\nI decided to simply use Docker, as this is what I use for my regular development anyhow.\nSimplest solution was to use an existing docker image,\nnamely [jbbarth's docker-black](https://github.com/jbbarth/docker-black),\nwhich allows you to mount the current working directory into a (newly created) container, format the desired file, and throw the container away afterwards.\nSounds more complicated than it is, you just run one single command et voila.\nThis method has the additional benefit that it adheres to any [pyproject.toml](https://github.com/psf/black#pyprojecttoml) which can store configuration like line length.\nThere's also a more sleek image at [cytopia/docker-black](https://github.com/cytopia/docker-black) which might take less space.\n\nSo to run black irrespective of your local Python installation via `black main.py`,\nyou run\n\n```text\ndocker run --rm -v $(pwd):/code jbbarth/black main.py\n```\n\nThis creates a new container, mounts the current working directory into `/code` and formats `main.py`.\nAfterwards, the `--rm` flag will delete the container as well as the created volume.\nSo far, so good, but as this command is quote long, I had to build an alias to invoke it quickly as a next step.\n\n## Challenge 2: Black from command line\n\nSo to avoid the cumbersome docker syntax each time, you now want an alias to just run `black main.py` everywhere.\nTo do this, you have to map the black command to your black running inside docker.\nYou can do this by adding\n\n```text\nblack() { docker run --rm -v $(pwd):/code jbbarth/black $*; }\n```\n\nto your bashrc or zshrc.\nAfter opening a new terminal, you should now be able to invoke the black formatter inside docker by running `black ...`.\n\n## Challenge 3: Black in PyCharm\n\nTo now integrate this setup into PyCharm,\nyou have to slightly adapt the [offical installation instructions](https://black.readthedocs.io/en/stable/editor_integration.html#pycharm-intellij-idea).\nGo to `File -> Settings -> Tools -> External Tools`.\nClick the + icon to add a new external tool with the following values:\n\n- Name: `Black`\n- Description: `Black code formatter`\n- Program: `/usr/bin/docker`\n- Arguments: `run --rm -v $FilePath$:/$FilePath$ jbbarth/black \"$FilePath$\"`\n- Working directory: `$ProjectFileDir$`\n\nTest it by running it with an opened python file via `Tools -> External Tools -> Black`.\nAfter you made sure it works, re-open it again and untick `open console` to avoid a new console at every run.\nYou can basically mirror this guide to install a file watcher\nthat formats on every save (see [the docs](https://black.readthedocs.io/en/stable/editor_integration.html#pycharm-intellij-idea)).\n\nNote: As you can see, this only mounts the current file and thus does not adhere to any config files.\nThe same applies for the next step as it builds upon this one.\n\n## Challenge 4: Black in IdeaVim\n\nNow for the bonus part: to trigger this setup quickly from within IdeaVim and format the current file with a single command,\nequivalent to the [regular vim plugin](https://black.readthedocs.io/en/stable/editor_integration.html#vim),\nwe have to map the `:Black` command to our external command in PyCharm.\nTo do this, we edit our `.ideavimrc` file where all IdeaVim configuration is stored,\nand add the following line:\n\n```text\ncommand Black action Tool_External Tools_Black\n```\n\nNow typing `:Black` will re-format the current file.\n\n## Summary\n\nThis tutorial showed you one way to include Black into you daily development (esp. on Debian).\nIf you have any questions or feedback, hit me up on Twitter [@karllorey](https://twitter.com/karllorey)\nor any of the other platforms listed below.\n\n## Notes\n\n### Deleting all docker containers of a specific image\n\nIf you want to remove all containers derived from a specific image, e.g. if you forgot to add the --rm flag:\n\n```text\ndocker rm $(docker ps -a --filter ancestor=jbbarth/black -q)\n```\n"},"mdxSource":{"compiledSource":"\"use strict\";\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst {useMDXComponents: _provideComponents} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = {\n    a: \"a\",\n    code: \"code\",\n    h2: \"h2\",\n    h3: \"h3\",\n    li: \"li\",\n    p: \"p\",\n    pre: \"pre\",\n    ul: \"ul\",\n    ..._provideComponents(),\n    ...props.components\n  };\n  return _jsxs(_Fragment, {\n    children: [_jsxs(_components.p, {\n      children: [\"I've come to like the code formatter \", _jsx(_components.a, {\n        href: \"https://black.readthedocs.io/en/stable/index.html\",\n        children: \"Black\"\n      }), \" for Python.\\nIt's opinionated, deterministic and thus very minimalistic.\\nAnd since I'm using it on more and more projects, I wanted to integrate it into my workflow.\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"So usually, you just install Black globally via \", _jsx(_components.code, {\n        children: \"pip3 install black\"\n      }), \".\\nBut since I use Debian which still ships with Python 3.5\\nthis yielded some smaller challenges as Black only runs under Python 3.6+.\\nThis post is a small tutorial on how you can use Black on Debian and integrate it into the command line, PyCharm, and IdeaVim.\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Challenge 1: Python 3.6+ on Debian\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Since Debian currently ships with Python 3.5, I needed to get Python 3.6 running somehow.\\nWhile installing \", _jsx(_components.a, {\n        href: \"https://www.anaconda.com/distribution/\",\n        children: \"Anaconda\"\n      }), \" or \", _jsx(_components.a, {\n        href: \"https://www.python.org/downloads/\",\n        children: \"Python 3.6+ manually\"\n      }), \"\\nare other solutions \", _jsx(_components.a, {\n        href: \"https://community.hortonworks.com/idea/212478/independent-python-vs-anaconda-python.html\",\n        children: \"might\"\n      }), \" \", _jsx(_components.a, {\n        href: \"https://unix.stackexchange.com/q/332641\",\n        children: \"work\"\n      }), \",\\nI decided to simply use Docker, as this is what I use for my regular development anyhow.\\nSimplest solution was to use an existing docker image,\\nnamely \", _jsx(_components.a, {\n        href: \"https://github.com/jbbarth/docker-black\",\n        children: \"jbbarth's docker-black\"\n      }), \",\\nwhich allows you to mount the current working directory into a (newly created) container, format the desired file, and throw the container away afterwards.\\nSounds more complicated than it is, you just run one single command et voila.\\nThis method has the additional benefit that it adheres to any \", _jsx(_components.a, {\n        href: \"https://github.com/psf/black#pyprojecttoml\",\n        children: \"pyproject.toml\"\n      }), \" which can store configuration like line length.\\nThere's also a more sleek image at \", _jsx(_components.a, {\n        href: \"https://github.com/cytopia/docker-black\",\n        children: \"cytopia/docker-black\"\n      }), \" which might take less space.\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"So to run black irrespective of your local Python installation via \", _jsx(_components.code, {\n        children: \"black main.py\"\n      }), \",\\nyou run\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-text\",\n        children: \"docker run --rm -v $(pwd):/code jbbarth/black main.py\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"This creates a new container, mounts the current working directory into \", _jsx(_components.code, {\n        children: \"/code\"\n      }), \" and formats \", _jsx(_components.code, {\n        children: \"main.py\"\n      }), \".\\nAfterwards, the \", _jsx(_components.code, {\n        children: \"--rm\"\n      }), \" flag will delete the container as well as the created volume.\\nSo far, so good, but as this command is quote long, I had to build an alias to invoke it quickly as a next step.\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Challenge 2: Black from command line\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"So to avoid the cumbersome docker syntax each time, you now want an alias to just run \", _jsx(_components.code, {\n        children: \"black main.py\"\n      }), \" everywhere.\\nTo do this, you have to map the black command to your black running inside docker.\\nYou can do this by adding\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-text\",\n        children: \"black() { docker run --rm -v $(pwd):/code jbbarth/black $*; }\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"to your bashrc or zshrc.\\nAfter opening a new terminal, you should now be able to invoke the black formatter inside docker by running \", _jsx(_components.code, {\n        children: \"black ...\"\n      }), \".\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Challenge 3: Black in PyCharm\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"To now integrate this setup into PyCharm,\\nyou have to slightly adapt the \", _jsx(_components.a, {\n        href: \"https://black.readthedocs.io/en/stable/editor_integration.html#pycharm-intellij-idea\",\n        children: \"offical installation instructions\"\n      }), \".\\nGo to \", _jsx(_components.code, {\n        children: \"File -> Settings -> Tools -> External Tools\"\n      }), \".\\nClick the + icon to add a new external tool with the following values:\"]\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsxs(_components.li, {\n        children: [\"Name: \", _jsx(_components.code, {\n          children: \"Black\"\n        })]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"Description: \", _jsx(_components.code, {\n          children: \"Black code formatter\"\n        })]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"Program: \", _jsx(_components.code, {\n          children: \"/usr/bin/docker\"\n        })]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"Arguments: \", _jsx(_components.code, {\n          children: \"run --rm -v $FilePath$:/$FilePath$ jbbarth/black \\\"$FilePath$\\\"\"\n        })]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"Working directory: \", _jsx(_components.code, {\n          children: \"$ProjectFileDir$\"\n        })]\n      }), \"\\n\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Test it by running it with an opened python file via \", _jsx(_components.code, {\n        children: \"Tools -> External Tools -> Black\"\n      }), \".\\nAfter you made sure it works, re-open it again and untick \", _jsx(_components.code, {\n        children: \"open console\"\n      }), \" to avoid a new console at every run.\\nYou can basically mirror this guide to install a file watcher\\nthat formats on every save (see \", _jsx(_components.a, {\n        href: \"https://black.readthedocs.io/en/stable/editor_integration.html#pycharm-intellij-idea\",\n        children: \"the docs\"\n      }), \").\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Note: As you can see, this only mounts the current file and thus does not adhere to any config files.\\nThe same applies for the next step as it builds upon this one.\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Challenge 4: Black in IdeaVim\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Now for the bonus part: to trigger this setup quickly from within IdeaVim and format the current file with a single command,\\nequivalent to the \", _jsx(_components.a, {\n        href: \"https://black.readthedocs.io/en/stable/editor_integration.html#vim\",\n        children: \"regular vim plugin\"\n      }), \",\\nwe have to map the \", _jsx(_components.code, {\n        children: \":Black\"\n      }), \" command to our external command in PyCharm.\\nTo do this, we edit our \", _jsx(_components.code, {\n        children: \".ideavimrc\"\n      }), \" file where all IdeaVim configuration is stored,\\nand add the following line:\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-text\",\n        children: \"command Black action Tool_External Tools_Black\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Now typing \", _jsx(_components.code, {\n        children: \":Black\"\n      }), \" will re-format the current file.\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Summary\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"This tutorial showed you one way to include Black into you daily development (esp. on Debian).\\nIf you have any questions or feedback, hit me up on Twitter \", _jsx(_components.a, {\n        href: \"https://twitter.com/karllorey\",\n        children: \"@karllorey\"\n      }), \"\\nor any of the other platforms listed below.\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Notes\"\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"Deleting all docker containers of a specific image\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"If you want to remove all containers derived from a specific image, e.g. if you forgot to add the --rm flag:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-text\",\n        children: \"docker rm $(docker ps -a --filter ancestor=jbbarth/black -q)\\n\"\n      })\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = {\n    ..._provideComponents(),\n    ...props.components\n  };\n  return MDXLayout ? _jsx(MDXLayout, {\n    ...props,\n    children: _jsx(_createMdxContent, {\n      ...props\n    })\n  }) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","frontmatter":{},"scope":{}}},"__N_SSG":true}