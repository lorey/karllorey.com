{"pageProps":{"post":{"title":"Switching from Lektor to Nikola (static site generators)","slug":"switch-from-lektor-to-nikola","date":"2020-03-10T16:03:35.000Z","tags":"Python, Lektor, Nikola, Tech","category":"Tech","link":null,"description":"Why I migrated and what to expect from both Python-based static site generators.","type":"text","status":null,"content":"\nI decided to migrate this website/blog from Lektor to Nikola.\nBoth are static site generators\nimplemented in Python\nthat allow you to generate a static, secure, and maintenance-free website/blog.\nHere is my experience, why I did it, how to do it, and what to expect.\nIn short: While I liked Lektor for its simplicity,\nit lacked several features I needed.\nSo far, Nikola has these features and many more\nwhich is why I'm very happy to have switched.\nRead the rest of the pros and cons here.\n\n# Background: Static Site Generators\n\nBoth Lektor and Nikola are Static Site Generators (SSG) implemented in Python.\nYou basically create everything on your computer and the the generator generates HTML\nwhich can be hosted on GitHub or almost everywhere without any hassle.\nBesides, it's blazing fast, secure, and needs no server configuration/maintenance.\nFind an overview at [Full Stack Python](https://www.fullstackpython.com/static-site-generator.html).\n\n# Lektor vs. Nikola\n\nWhen I created this website, I chose Lektor for it's simplicity.\nCompared to Wordpress, which I had used before, it was easy to set up and maintain.\n\n## Why not Lektor?\n\n- to little default markup: the site did not rank for quite some time which might be due to litte semantic markup\n- it especially misses several essential features to rank and make the site visible\n  - no RSS feed by default which allows search engines to discover new posts quickly\n  - no meta tags which would enable nice previews on social media (OpenGraph for Facebook, etc.)\n- default directory structure: blog posts in Lektor all have an own folder containing a file named contents.lr.\n  While this looks trivial and helps with structuring files belonging to a post, I simply did not like it too much.\n- Lektor does not use regular virtualenv environments which just makes stuff a little trickier to understand\n- the ecosystem is small, there are not many plugins, and development seems to have halted\n\n## Why Nikola?\n\nAgain, this is highly opinionated.\n\n- most-active repository compared to [Lektor](https://github.com/lektor/lektor), [Pelican](https://github.com/getpelican/pelican), [MkDocs](https://github.com/mkdocs/mkdocs/), [mynt](https://github.com/Anomareh/mynt), and other static site generators in Python\n- seamless integration of blog posts and regular pages\n- clear documentation\n- lots(!) of features and configuration options\n- RSS feeds, tags, categories, blog archives, etc.\n- themes with semantic HTML\n\n# Switching from Lektor to Nikola\n\nI basically set up a clean Nikola project and then adapted my old content.\nHere's what I did with a rough time estimation:\n\n- Reading the docs and getting started (30m)\n- Setting up a clean project within my existing repo (30m)\n- Renaming articles and sites (15m)\n- adding Nikola-specific markdown headers (5m per site/article)\n- formatting code blocks to leverage syntax highlighting and fixing markdown errors (30m)\n- integrating my existing theme into Nikola (2h)\n- setting up deployment on Travis CI (30m)\n\n# What I like so far\n\n- a lot of functionality with sane defaults\n- whole transition took me less than one day, no weird errors, no frustration\n- clean structure that enables (even hierarchical) posts and pages without any issues\n- super fast deployment setup with github (took me one minute)\n- great default/base templates with mako or jinja as a templating engine that can be adapted really easily\n\n# What I don't like so far\n\n- The config file is huge and includes a lot of documentation, basically very similar to Django.\n  While I like to configure stuff, it's hard to find settings and understand all implications.\n- Lektor has an amazing concept to define own models, I haven't figured out how to do something similar in Nikola, e.g. for my [CV](/founder).\n- There are not many templates available. I've also found my template to be quite messy and without clean syntax.\n- There's a plugin system heavily relying on [doit](https://pydoit.org/) which makes site-creation very efficient but extending as a result rather difficult to understand. For example, I don't know how to insert a list of all subpages into the the current page which should be quite easy.\n\n# Issues\n\nIf you're also getting started, here are the issues I ran into.\nAs I said, not many and not frustrating :)\n\n## Overwriting themes\n\nWhile there are a few basic and advanced themes you can build upon,\nit took me quite some time to find out where these themes can be found.\nThis is necessary to understand which files there are and which files you need to overwrite to adapt a theme.\nBasically most templates you can inherit from can be found at [nikola-themes](https://github.com/getnikola/nikola-themes)\nbut some basic templates are stored within [Nikola itself](https://github.com/getnikola/nikola/tree/c886ea38f7ee34f1fffb3edae7087694483a999d/nikola/data/themes).\nIf you've understood this, you basically just copy/paste the files you want to adapt inside your own theme\nwhich works really nice.\n\n## Deployment with existing gh-pages\n\nSince I had previously set up Lektor deployment via GitHub Pages, I already had a `gh-pages` branch.\nSo when I tried to deploy via `nikola github_deploy`, I got the following error:\n\n```text\nTo github.com:lorey/karllorey.com.git\n ! [rejected]        gh-pages -> gh-pages (fetch first)\nerror: failed to push some refs to 'git@github.com:lorey/karllorey.com.git'\nhint: Updates were rejected because the remote contains work that you do\nhint: not have locally. This is usually caused by another repository pushing\nhint: to the same ref. You may want to first integrate the remote changes\nhint: (e.g., 'git pull ...') before pushing again.\nhint: See the 'Note about fast-forwards' in 'git push --help' for details.\n# .stacktrace\n[2020-02-25T15:12:28Z] ERROR: github_deploy: Failed GitHub deployment -- command ['ghp-import', '-n', '-m', 'Nikola auto commit.\\n\\nSource commit: 5d74f162affaf80691de1d7c7b0d8728addea96a\\nNikola version: 8.0.4', '-p', '-r', 'origin', '-b', 'gh-pages', 'output'] returned 1\n```\n\nObviously, I forgot to pull the gh-pages branch first, so the new commit could be added on top.\nAfter doing a `git pull origin gh-pages`, deploying worked like a charm.\n\n## Deployment with Travis CI\n\nTo deploy with Travis CI, there's a great [post on the Nikola blog](https://getnikola.com/blog/automating-nikola-rebuilds-with-travis-ci.html).\nWhat I did not understand at first was the distinction between the `master` and a `src` branch.\nSo the `src` branch is used for user pages that are deployed into the master branch, i.e. when you have a site pointing to you username, e.g. `lorey.github.io`.\nIf you do that, you have to use another branch to deploy to avoid an infinite loop (push to master > deploy to master > ...).\nSince I use `gh-pages` as the branch containing all the generated HTML, I set up .travis.yml to deploy on pushes to master.\nIn the `conf.py` I still set:\n\n```python\nGITHUB_SOURCE_BRANCH = 'src'\n```\n\nSeems to work fine.\n\nAnother thing I encountered when setting up Travis CI:\nSomehow the travis gem had issues when logging in so `travis login` and `travis enable` did not work.\nMaybe because I use an old version or have 2FA enabled.\nIn the end I just ran `travis encrypt-file id_rsa --add` which worked fine and added a line to .travis.yml\nstoring the encrypted key.\n\nDoing a `git branch master FETCH_HEAD` inside the .travis.yml failed:\n\n```text\n$ git branch master FETCH_HEAD\nfatal: A branch named 'master' already exists.\nThe command \"git branch master FETCH_HEAD\" failed and exited with 128 during .\n```\n"},"mdxSource":{"compiledSource":"\"use strict\";\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst {useMDXComponents: _provideComponents} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = {\n    a: \"a\",\n    code: \"code\",\n    h1: \"h1\",\n    h2: \"h2\",\n    li: \"li\",\n    p: \"p\",\n    pre: \"pre\",\n    ul: \"ul\",\n    ..._provideComponents(),\n    ...props.components\n  };\n  return _jsxs(_Fragment, {\n    children: [_jsx(_components.p, {\n      children: \"I decided to migrate this website/blog from Lektor to Nikola.\\nBoth are static site generators\\nimplemented in Python\\nthat allow you to generate a static, secure, and maintenance-free website/blog.\\nHere is my experience, why I did it, how to do it, and what to expect.\\nIn short: While I liked Lektor for its simplicity,\\nit lacked several features I needed.\\nSo far, Nikola has these features and many more\\nwhich is why I'm very happy to have switched.\\nRead the rest of the pros and cons here.\"\n    }), \"\\n\", _jsx(_components.h1, {\n      children: \"Background: Static Site Generators\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Both Lektor and Nikola are Static Site Generators (SSG) implemented in Python.\\nYou basically create everything on your computer and the the generator generates HTML\\nwhich can be hosted on GitHub or almost everywhere without any hassle.\\nBesides, it's blazing fast, secure, and needs no server configuration/maintenance.\\nFind an overview at \", _jsx(_components.a, {\n        href: \"https://www.fullstackpython.com/static-site-generator.html\",\n        children: \"Full Stack Python\"\n      }), \".\"]\n    }), \"\\n\", _jsx(_components.h1, {\n      children: \"Lektor vs. Nikola\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"When I created this website, I chose Lektor for it's simplicity.\\nCompared to Wordpress, which I had used before, it was easy to set up and maintain.\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Why not Lektor?\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"to little default markup: the site did not rank for quite some time which might be due to litte semantic markup\"\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"it especially misses several essential features to rank and make the site visible\", \"\\n\", _jsxs(_components.ul, {\n          children: [\"\\n\", _jsx(_components.li, {\n            children: \"no RSS feed by default which allows search engines to discover new posts quickly\"\n          }), \"\\n\", _jsx(_components.li, {\n            children: \"no meta tags which would enable nice previews on social media (OpenGraph for Facebook, etc.)\"\n          }), \"\\n\"]\n        }), \"\\n\"]\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"default directory structure: blog posts in Lektor all have an own folder containing a file named contents.lr.\\nWhile this looks trivial and helps with structuring files belonging to a post, I simply did not like it too much.\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"Lektor does not use regular virtualenv environments which just makes stuff a little trickier to understand\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"the ecosystem is small, there are not many plugins, and development seems to have halted\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Why Nikola?\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Again, this is highly opinionated.\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsxs(_components.li, {\n        children: [\"most-active repository compared to \", _jsx(_components.a, {\n          href: \"https://github.com/lektor/lektor\",\n          children: \"Lektor\"\n        }), \", \", _jsx(_components.a, {\n          href: \"https://github.com/getpelican/pelican\",\n          children: \"Pelican\"\n        }), \", \", _jsx(_components.a, {\n          href: \"https://github.com/mkdocs/mkdocs/\",\n          children: \"MkDocs\"\n        }), \", \", _jsx(_components.a, {\n          href: \"https://github.com/Anomareh/mynt\",\n          children: \"mynt\"\n        }), \", and other static site generators in Python\"]\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"seamless integration of blog posts and regular pages\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"clear documentation\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"lots(!) of features and configuration options\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"RSS feeds, tags, categories, blog archives, etc.\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"themes with semantic HTML\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.h1, {\n      children: \"Switching from Lektor to Nikola\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"I basically set up a clean Nikola project and then adapted my old content.\\nHere's what I did with a rough time estimation:\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"Reading the docs and getting started (30m)\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"Setting up a clean project within my existing repo (30m)\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"Renaming articles and sites (15m)\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"adding Nikola-specific markdown headers (5m per site/article)\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"formatting code blocks to leverage syntax highlighting and fixing markdown errors (30m)\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"integrating my existing theme into Nikola (2h)\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"setting up deployment on Travis CI (30m)\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.h1, {\n      children: \"What I like so far\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"a lot of functionality with sane defaults\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"whole transition took me less than one day, no weird errors, no frustration\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"clean structure that enables (even hierarchical) posts and pages without any issues\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"super fast deployment setup with github (took me one minute)\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"great default/base templates with mako or jinja as a templating engine that can be adapted really easily\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.h1, {\n      children: \"What I don't like so far\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"The config file is huge and includes a lot of documentation, basically very similar to Django.\\nWhile I like to configure stuff, it's hard to find settings and understand all implications.\"\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"Lektor has an amazing concept to define own models, I haven't figured out how to do something similar in Nikola, e.g. for my \", _jsx(_components.a, {\n          href: \"/founder\",\n          children: \"CV\"\n        }), \".\"]\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"There are not many templates available. I've also found my template to be quite messy and without clean syntax.\"\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"There's a plugin system heavily relying on \", _jsx(_components.a, {\n          href: \"https://pydoit.org/\",\n          children: \"doit\"\n        }), \" which makes site-creation very efficient but extending as a result rather difficult to understand. For example, I don't know how to insert a list of all subpages into the the current page which should be quite easy.\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.h1, {\n      children: \"Issues\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"If you're also getting started, here are the issues I ran into.\\nAs I said, not many and not frustrating :)\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Overwriting themes\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"While there are a few basic and advanced themes you can build upon,\\nit took me quite some time to find out where these themes can be found.\\nThis is necessary to understand which files there are and which files you need to overwrite to adapt a theme.\\nBasically most templates you can inherit from can be found at \", _jsx(_components.a, {\n        href: \"https://github.com/getnikola/nikola-themes\",\n        children: \"nikola-themes\"\n      }), \"\\nbut some basic templates are stored within \", _jsx(_components.a, {\n        href: \"https://github.com/getnikola/nikola/tree/c886ea38f7ee34f1fffb3edae7087694483a999d/nikola/data/themes\",\n        children: \"Nikola itself\"\n      }), \".\\nIf you've understood this, you basically just copy/paste the files you want to adapt inside your own theme\\nwhich works really nice.\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Deployment with existing gh-pages\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Since I had previously set up Lektor deployment via GitHub Pages, I already had a \", _jsx(_components.code, {\n        children: \"gh-pages\"\n      }), \" branch.\\nSo when I tried to deploy via \", _jsx(_components.code, {\n        children: \"nikola github_deploy\"\n      }), \", I got the following error:\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-text\",\n        children: \"To github.com:lorey/karllorey.com.git\\n ! [rejected]        gh-pages -> gh-pages (fetch first)\\nerror: failed to push some refs to 'git@github.com:lorey/karllorey.com.git'\\nhint: Updates were rejected because the remote contains work that you do\\nhint: not have locally. This is usually caused by another repository pushing\\nhint: to the same ref. You may want to first integrate the remote changes\\nhint: (e.g., 'git pull ...') before pushing again.\\nhint: See the 'Note about fast-forwards' in 'git push --help' for details.\\n# .stacktrace\\n[2020-02-25T15:12:28Z] ERROR: github_deploy: Failed GitHub deployment -- command ['ghp-import', '-n', '-m', 'Nikola auto commit.\\\\n\\\\nSource commit: 5d74f162affaf80691de1d7c7b0d8728addea96a\\\\nNikola version: 8.0.4', '-p', '-r', 'origin', '-b', 'gh-pages', 'output'] returned 1\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Obviously, I forgot to pull the gh-pages branch first, so the new commit could be added on top.\\nAfter doing a \", _jsx(_components.code, {\n        children: \"git pull origin gh-pages\"\n      }), \", deploying worked like a charm.\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Deployment with Travis CI\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"To deploy with Travis CI, there's a great \", _jsx(_components.a, {\n        href: \"https://getnikola.com/blog/automating-nikola-rebuilds-with-travis-ci.html\",\n        children: \"post on the Nikola blog\"\n      }), \".\\nWhat I did not understand at first was the distinction between the \", _jsx(_components.code, {\n        children: \"master\"\n      }), \" and a \", _jsx(_components.code, {\n        children: \"src\"\n      }), \" branch.\\nSo the \", _jsx(_components.code, {\n        children: \"src\"\n      }), \" branch is used for user pages that are deployed into the master branch, i.e. when you have a site pointing to you username, e.g. \", _jsx(_components.code, {\n        children: \"lorey.github.io\"\n      }), \".\\nIf you do that, you have to use another branch to deploy to avoid an infinite loop (push to master > deploy to master > ...).\\nSince I use \", _jsx(_components.code, {\n        children: \"gh-pages\"\n      }), \" as the branch containing all the generated HTML, I set up .travis.yml to deploy on pushes to master.\\nIn the \", _jsx(_components.code, {\n        children: \"conf.py\"\n      }), \" I still set:\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-python\",\n        children: \"GITHUB_SOURCE_BRANCH = 'src'\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Seems to work fine.\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Another thing I encountered when setting up Travis CI:\\nSomehow the travis gem had issues when logging in so \", _jsx(_components.code, {\n        children: \"travis login\"\n      }), \" and \", _jsx(_components.code, {\n        children: \"travis enable\"\n      }), \" did not work.\\nMaybe because I use an old version or have 2FA enabled.\\nIn the end I just ran \", _jsx(_components.code, {\n        children: \"travis encrypt-file id_rsa --add\"\n      }), \" which worked fine and added a line to .travis.yml\\nstoring the encrypted key.\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Doing a \", _jsx(_components.code, {\n        children: \"git branch master FETCH_HEAD\"\n      }), \" inside the .travis.yml failed:\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-text\",\n        children: \"$ git branch master FETCH_HEAD\\nfatal: A branch named 'master' already exists.\\nThe command \\\"git branch master FETCH_HEAD\\\" failed and exited with 128 during .\\n\"\n      })\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = {\n    ..._provideComponents(),\n    ...props.components\n  };\n  return MDXLayout ? _jsx(MDXLayout, {\n    ...props,\n    children: _jsx(_createMdxContent, {\n      ...props\n    })\n  }) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","frontmatter":{},"scope":{}}},"__N_SSG":true}